<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Notary AI ‚Ä¢ Generate Legal Document</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    :root {
      --blue-1: #1e40af;
      --blue-2: #3b82f6;
      --blue-3: #eef3ff;
      --bg-light: #f4f7ff;
      --text: #222;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: var(--bg-light);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: start;
      padding: 40px 16px;
    }

    h2 {
      text-align: center;
      margin-bottom: 28px;
      color: var(--blue-1);
    }

    .card {
      width: 100%;
      max-width: 680px;
      background: #fff;
      padding: 40px 32px;
      border-radius: 18px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, .08);
      animation: fadeUp .7s ease-out;
    }

    @keyframes fadeUp {
      from {
        opacity: 0;
        transform: translateY(40px)
      }

      to {
        opacity: 1;
        transform: translateY(0)
      }
    }

    label {
      font-weight: 500;
    }

    input,
    textarea,
    select {
      width: 100%;
      margin: 10px 0 24px 0;
      padding: 12px 14px;
      border: 1px solid #d0d7ff;
      border-radius: 8px;
      font-size: .95rem;
      transition: border .25s, box-shadow .25s;
    }

    input:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: var(--blue-2);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, .2);
    }

    .btn {
      padding: 12px 32px;
      border: none;
      border-radius: 10px;
      background: var(--blue-2);
      color: #fff;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: .25s;
      box-shadow: 0 4px 12px rgba(0, 0, 0, .1);
    }

    .btn:hover {
      background: var(--blue-1);
      transform: translateY(-2px);
    }

    #status {
      margin-top: 20px;
      font-weight: 600;
      text-align: center;
      white-space: pre-wrap;
    }

    .form-section {
      display: none;
    }

    .form-section.active {
      display: block;
    }

    @media(max-width:550px) {
      .card {
        padding: 28px 22px;
      }

      input,
      textarea,
      select {
        font-size: .9rem;
      }

      .btn {
        width: 100%;
      }
    }
  </style>
</head>

<body>

  <div class="card">
    <h2>Generate Legal Document</h2>

    <label for="draftType">Select Draft Type</label>
    <select id="draftType">
      <option value="partnership">Partnership Deed</option>
      <option value="rent">Rent Agreement</option>
      <option value="hakkasod_ai">Hakkasod Patra (AI)</option>
      <option value="hakkasod_ai_docx">Hakkasod Patra (AI + Word)</option>
    </select>

    <form id="documentForm">
      <!-- Partnership -->
      <div id="partnershipForm" class="form-section active">
        <label>Firm Name</label><input name="firm_name" required>
        <label>Business Type</label><input name="business_type" required>

        <label>Partner 1 Full Name</label><input name="partner1_full_name" required>
        <label>Partner 1 Father's Name</label><input name="partner1_father_name" required>
        <label>Partner 1 Age</label><input name="partner1_age" required>
        <label>Partner 1 Address</label><input name="partner1_address" required>

        <label>Partner 2 Full Name</label><input name="partner2_full_name" required>
        <label>Partner 2 Father's Name</label><input name="partner2_father_name" required>
        <label>Partner 2 Age</label><input name="partner2_age" required>
        <label>Partner 2 Address</label><input name="partner2_address" required>

        <label>Capital Contribution</label><input name="capital_contribution" required>
        <label>Profit Sharing</label><input name="profit_sharing" required>
        <label>Duties</label><textarea name="duties" rows="4" required></textarea>

        <label>Execution Date</label><input type="date" name="execution_date">
        <label>Jurisdiction</label><input name="jurisdiction">
        <label>Business Address</label><input name="business_address">
        <label>Area of Operation</label><input name="area_of_operation">
        <label>Start Date</label><input type="date" name="start_date">
      </div>

      <!-- Rent -->
      <div id="rentForm" class="form-section">
        <label>Landlord Name</label><input name="landlord_name" required>
        <label>Landlord Address</label><input name="landlord_address" required>
        <label>Tenant Name</label><input name="tenant_name" required>
        <label>Tenant Address</label><input name="tenant_address" required>
        <label>Property Address</label><input name="property_address" required>
        <label>Rent Amount (‚Çπ)</label><input name="rent_amount" required>
        <label>Deposit Amount (‚Çπ)</label><input name="deposit_amount" required>
        <label>Rent Start Date</label><input type="date" name="rent_start_date" required>
        <label>Rent End Date</label><input type="date" name="rent_end_date" required>
      </div>

      <!-- Hakkasod AI -->
      <div id="hakkasod_aiForm" class="form-section">
        <label>Describe the Case (in Marathi)</label>
        <textarea name="scenario" rows="6"
          placeholder="‡§â‡§¶‡§æ‡§π‡§∞‡§£: ‡§ï‡•ã‡§≤‡§Ç‡§¨‡§ï‡§∞ ‡§ï‡•Å‡§ü‡•Å‡§Ç‡§¨‡§æ‡§§‡•Ä‡§≤ ‡•´ ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡•Ä‡§Ç‡§®‡•Ä ‡§ñ‡§æ‡§≤‡•á‡§ó‡§æ‡§µ ‡§Ø‡•á‡§•‡•Ä‡§≤ ‡§ú‡§Æ‡§ø‡§®‡•Ä‡§µ‡§∞‡•Ä‡§≤ ‡§π‡§ï‡•ç‡§ï ‡§Ø‡•Å‡§µ‡§∞‡§æ‡§ú ‡§ï‡•ã‡§≤‡§Ç‡§¨‡§ï‡§∞ ‡§Ø‡§æ‡§ö‡•ç‡§Ø‡§æ ‡§®‡§æ‡§µ‡•á ‡§∏‡•ã‡§°‡§≤‡•á ‡§Ü‡§π‡•á‡§§..."></textarea>
      </div>

      <button type="submit" class="btn">Generate Document</button>
      <p id="status"></p>
    </form>
  </div>

  <script>
    const draftTypeSelect = document.getElementById('draftType');
    const sections = document.querySelectorAll('.form-section');

    function switchSection(v) {
      sections.forEach(sec => {
        sec.classList.toggle('active', sec.id === v + 'Form');
      });
    }

    function updateRequired() {
      sections.forEach(sec => {
        sec.querySelectorAll('input,textarea')
          .forEach(i => i.required = sec.classList.contains('active') && i.dataset.req === '1');
      });
    }

    // Store default required fields
    document.querySelectorAll('input,textarea').forEach(el => {
      if (el.required) el.dataset.req = "1";
    });

    draftTypeSelect.addEventListener('change', () => {
      switchSection(draftTypeSelect.value);
      updateRequired();
    });

    // Auto-select draft type from URL if ?draft=... is passed
    const draftFromURL = new URLSearchParams(location.search).get('draft');
    if (draftFromURL) {
      draftTypeSelect.value = draftFromURL;
      switchSection(draftFromURL);
      updateRequired();
    }

    const form = document.getElementById('documentForm');
    const status = document.getElementById('status');

    form.addEventListener('submit', async e => {
      e.preventDefault();
      status.textContent = '‚è≥ Generating...';
      status.style.color = 'dodgerblue';

      const activeForm = document.querySelector('.form-section.active');
      const data = { user_token: localStorage.getItem('token') };
      activeForm.querySelectorAll('input,textarea').forEach(inp => data[inp.name] = inp.value);

      try {
        let endpoint = "";
        let useBlob = true;

        if (draftTypeSelect.value === "hakkasod_ai") {
          endpoint = "http://127.0.0.1:8000/hakkasod/generate-ai";
          useBlob = false;
        } else {
          endpoint = `http://127.0.0.1:8000/${draftTypeSelect.value}/generate`;
        }

        const res = await fetch(endpoint, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });

        if (!res.ok) throw new Error('Generation failed');

        if (useBlob) {
          const blob = await res.blob();
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `${draftTypeSelect.value}_document.docx`;
          document.body.appendChild(a);
          a.click();
          a.remove();
          status.textContent = '‚úÖ Document downloaded!';
          status.style.color = 'green';
        } else {
          const result = await res.json();
          status.textContent = "üìÑ Draft Preview:\n\n" + result.draft;
          status.style.color = "#111";
        }

      } catch (err) {
        status.textContent = '‚ùå ' + err.message;
        status.style.color = 'red';
      }
    });
  </script>
</body>

</html>